     1                                  extern int_to_str
     2                                  
     3                                  section .data
     4 00000000 0000000084D79741            precision dq 100000000.0              ; For floating-point math
     5 00000008 00E1F50500000000            precision_int dq 100000000            ; Integer version for integer math
     6 00000010 2E00                        decimal db ".", 0
     7 00000012 E17A14AE47D78340            float_value dq 634.91
     8                                  
     9                                  section .bss
    10                                  
    11                                  section .text
    12                                  global ftoa
    13                                  
    14                                  ftoa:
    15                                      ; movsd xmm0, [float_value]  
    16 00000000 F2480F2CC0                  cvttsd2si rax, xmm0           ; 634.91 --> 634 TRUNCATE
    17 00000005 4989C2                      mov r10, rax                  ; LHS of decimal = r10 
    18 00000008 E8(00000000)                call int_to_str               ; Convert LHS to string
    19                                      ; mov r14, rax     
    20                                  
    21 0000000D 4889C6                      mov rsi, rax                 
    22 00000010 B801000000                  mov rax, 1                    
    23 00000015 BF01000000                  mov rdi, 1                    
    24 0000001A BA0A000000                  mov rdx, 10                   
    25 0000001F 0F05                        syscall
    26                                              
    27                                  
    28 00000021 F20F100C25-                 movsd xmm1, [precision]       ; xmm1 = 1000.0
    28 00000026 [00000000]         
    29 0000002A F20F10D0                    movsd xmm2, xmm0              ; xmm2 = 634.91
    30 0000002E F20F59D1                    mulsd xmm2, xmm1              ; 634.91 * 1000 = 634910
    31 00000032 F24C0F2CCA                  cvttsd2si r9, xmm2            ; r9 = 634910
    32                                  
    33 00000037 4C8B1C25[08000000]          mov r11, [precision_int]          ; r11 = 1000
    34 0000003F 4D0FAFD3                    imul r10, r11                 ; 634 * 1000 = 634000
    35                                  
    36 00000043 4D89C8                      mov r8, r9                    ; r8 = 634910
    37 00000046 4D29D0                      sub r8, r10                   ; 634910 - 634000 = 910 Subtract to get RHS of decimal
    38 00000049 4C89C0                      mov rax, r8                   ; rax = 9100
    39 0000004C E8(00000000)                call int_to_str               ; Convert 9100 to string
    40 00000051 4989C4                      mov r12, rax
    41                                  
    42                                  
    43 00000054 B801000000                  mov rax, 1                
    44 00000059 BF01000000                  mov rdi, 1                   
    45 0000005E 48BE-                       mov rsi, decimal                   
    45 00000060 [1000000000000000] 
    46 00000068 BA01000000                  mov rdx, 1                   
    47 0000006D 0F05                        syscall           
    48                                  
    49 0000006F B801000000                  mov rax, 1                
    50 00000074 BF01000000                  mov rdi, 1                   
    51 00000079 4C89E6                      mov rsi, r12                   
    52 0000007C BA0A000000                  mov rdx, 10                   
    53 00000081 0F05                        syscall
    54                                  
    55                                  
    56 00000083 C3                          ret
